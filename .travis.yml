env:
  global:
    TERM=dumb

language: java
jdk: oraclejdk8

apt:
  update: true
  packages:
  - wget
  - docker-ce
  - python-pip
  - curl
  - jq
  - libxml2-utils

install: true
before_install:
- sudo pip install httpie >/dev/null 2>&1

script:
- bash gradlew -S

# import functions
- source <(curl -s https://raw.githubusercontent.com/daggerok/bash-functions/master/main.bash)

# run embedded kafka listening port 9092
- wget -O /tmp/kafka.jar https://github.com/daggerok/embedded-kafka/raw/mvn-repo/embedded-kafka-0.0.3-all.jar
- java -jar /tmp/kafka.jar &
- wait_for 9092
- echo "kafka up and running"
- stop_any 9092

# run nginx in docker and wait for listening port 80
# make a note: even if service not yet started, in this case lsof will show you pid (from docker I suppose...)
- docker run -d -p 80:80 --rm --name nginx nginx:alpine
- wait_for 80
- http :80/
- stop_any 80
