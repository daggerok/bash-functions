plugins {
  id 'base'
}

group 'com.github.daggerok'
version '1.0.1'

wrapper {
  gradleVersion = '4.8'
  distributionType = 'BIN'
}

['bash', 'fish'].each { ext ->

  def fqdn = "# ${project.group}:${project.name}:${project.version} #"
  def separator = '#' * fqdn.length()

  build.doLast {
    file("$projectDir/main.$ext").text =
        file("$projectDir/src".replaceAll('\\\\', '/'))
            .listFiles()
            .findAll { it.name.endsWith(".$ext") }
            .collect { it.text }
            .join("${separator}\n") +
      """\
         |${separator}
         |${fqdn}
         |${separator}
         |""".stripMargin()
  }

  clean.doFirst {
    ['.gradle', "main.$ext"]
        .each { delete "$projectDir/$it" }
  }
}

defaultTasks 'clean', 'build'
